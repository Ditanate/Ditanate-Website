<!DOCTYPE html>

<html lang="ru">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Private Chat | Ditanate</title>

    <link rel="icon" type="image/png" href="favicon.png">

    <style>

        :root {

            --bg: #0f0f13;

            --accent: #ff9d00;

            --glass: rgba(255, 255, 255, 0.05);

            --error: #ff4444;

        }



        body {

            margin: 0;

            font-family: 'Segoe UI', sans-serif;

            background: radial-gradient(circle at center, #1a1a2e 0%, #0f0f13 100%);

            color: white;

            display: flex;

            justify-content: center;

            align-items: center;

            height: 100vh;

            overflow: hidden;

        }



        .back-hub {

            position: absolute; top: 20px; left: 20px; color: #666;

            text-decoration: none; font-size: 0.8rem; text-transform: uppercase; transition: 0.3s;

        }

        .back-hub:hover { color: var(--accent); }



        /* –í–û–ó–í–†–ê–©–ï–ù–ù–´–ô –î–ò–ó–ê–ô–ù –ö–ê–†–¢–û–ß–ï–ö */

        .login-card, .chat-card {

            background: var(--glass);

            padding: 40px;

            border-radius: 20px;

            border: 1px solid rgba(255,255,255,0.05);

            text-align: center;

            width: 100%;

            max-width: 400px;

            backdrop-filter: blur(10px);

        }



        .chat-card { display: none; max-width: 600px; height: 80vh; flex-direction: column; }

        

        #pin-panel {

            background: rgba(255, 157, 0, 0.1); border-left: 4px solid var(--accent);

            padding: 10px; margin-bottom: 10px; text-align: left; display: none;

            font-size: 0.85rem; cursor: pointer;

        }



        #msgs { flex: 1; overflow-y: auto; text-align: left; margin: 20px 0; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 10px; }

        

        .msg { margin-bottom: 10px; font-size: 0.9rem; }

        .msg b { color: var(--accent); cursor: pointer; }

        .console-msg { color: #55ff55; font-style: italic; }



        h1 { font-size: 1.5rem; letter-spacing: 2px; margin-bottom: 10px; }

        p { color: #666; font-size: 0.9rem; margin-bottom: 30px; }



        .input-group { text-align: left; margin-bottom: 15px; }



        input {

            width: 100%; padding: 12px; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1);

            border-radius: 8px; color: white; box-sizing: border-box;

        }

        input:focus { border-color: var(--accent); outline: none; }

        

        .error-text { color: var(--error); font-size: 0.75rem; margin-top: 5px; display: none; }



        .btn {

            width: 100%; padding: 12px; background: var(--accent); border: none;

            border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s;

            text-transform: uppercase; color: black; margin-top: 10px;

        }

        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255,157,0,0.3); }



        .footer-note { font-size: 0.7rem; color: #444; margin-top: 20px; }



        /* –ö–û–ù–¢–ï–ö–°–¢–ù–û–ï –ú–ï–ù–Æ */

        #context-menu {

            position: fixed; display: none; background: #15151e; border: 1px solid #333;

            border-radius: 8px; z-index: 1000; width: 180px;

            box-shadow: 0 10px 30px rgba(0,0,0,0.8);

        }

        .ctx-item { padding: 10px 15px; cursor: pointer; font-size: 0.85rem; color: #ddd; }

        .ctx-item:hover { background: var(--accent); color: #000; }

        .ctx-red:hover { background: var(--error); color: white; }

    </style>

</head>

<body>



    <a href="https://ditanate.pro" class="back-hub">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ HUB</a>



    <div id="login-box" class="login-card">

        <h1>DITANATE PRIVATE</h1>

        <p>–î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ª–∏—Ü</p>

        <form onsubmit="event.preventDefault(); login();">

            <div class="input-group">

                <input type="text" id="user" name="username" placeholder="Username" autocomplete="username">

                <div id="user-error" class="error-text">–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>

            </div>

            <div class="input-group">

                <input type="password" id="pass" name="password" placeholder="Password" autocomplete="current-password">

                <div id="pass-error" class="error-text">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</div>

            </div>

            <button type="submit" class="btn">–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç</button>

        </form>

        <div id="general-error" class="error-text" style="text-align:center; margin-top:10px;"></div>

        <div class="footer-note">

            –ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Ö–æ–¥–∞, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å Ditanate.<br>

            ¬© 2026 Ditanate. Protected area. All rights reserved.

        </div>

    </div>



    <div id="chat-box" class="chat-card">

        <h1>PRIVATE CHAT</h1>

        <div id="pin-panel" onclick="unpinMsg()">

            <div style="font-weight:bold; color:var(--accent)">üìå –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–æ</div>

            <div id="pin-content" style="color:#ddd; font-size: 0.8rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">...</div>

        </div>

        <div id="msgs">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...</div>

        <div>

            <div style="display:flex; gap: 10px;">

                <input type="text" id="msg-text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." onkeydown="if(event.key==='Enter') send()">

                <button onclick="send()" class="btn" style="width: 80px; margin:0;">‚Üí</button>

            </div>

            <div id="empty-err" class="error-text" style="text-align:left;">–í—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—É—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!</div>

        </div>

        <button onclick="logout()" style="background:none; border:none; color:#444; cursor:pointer; margin-top:10px; font-size:10px;">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>

    </div>



    <div id="context-menu">

        <div class="ctx-item" onclick="replyMsg()">‚Ü© –û—Ç–≤–µ—Ç–∏—Ç—å</div>

        <div class="ctx-item" onclick="copyMsg()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</div>

        <div id="admin-tools" style="display:none">

            <div style="height:1px; background:#333;"></div>

            <div class="ctx-item" onclick="pinMsg()">üìå –ó–∞–∫—Ä–µ–ø–∏—Ç—å</div>

            <div class="ctx-item ctx-red" onclick="deleteMsg()">üóë –£–¥–∞–ª–∏—Ç—å</div>

        </div>

    </div>



    <script>

        const SS_URL = "https://script.google.com/macros/s/AKfycbyxh_BST2b-gX5ANLXYo7nPGrAH6xWB-uXmZjWPaMId0CCrTWmV7GTOWsXeuKkVvNTV/exec";

        const notifSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3'); 



        let currentUser = localStorage.getItem('ditanate_user');

        let isAdmin = localStorage.getItem('ditanate_role') === 'admin';

        let selText, selAuthor, selId;



        if(currentUser) initChat();



        async function login() {

            const u = document.getElementById('user').value;

            const p = document.getElementById('pass').value;

            if(!u || !p) return;

            const response = await fetch(SS_URL, {method: 'POST', body: JSON.stringify({type: "login", user: u, pass: p})});

            const data = await response.json();

            if (data.res === "ok") {

                localStorage.setItem('ditanate_user', u);

                if(u.toLowerCase() === 'ditanate') localStorage.setItem('ditanate_role', 'admin');

                location.reload();

            } else {

                document.getElementById('general-error').innerText = "–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!";

                document.getElementById('general-error').style.display = 'block';

            }

        }



        function initChat() {

            document.getElementById('login-box').style.display = 'none';

            document.getElementById('chat-box').style.display = 'flex';

            if(isAdmin) document.getElementById('admin-tools').style.display = 'block';

            loadMessages();

            setInterval(loadMessages, 5000);

        }



        function logout() {

            if(confirm("–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?")) {

                localStorage.clear();

                location.reload();

            }

        }



        async function send() {

            const inp = document.getElementById('msg-text');

            const err = document.getElementById('empty-err');

            let txt = inp.value.trim();

            if(!txt) { err.style.display='block'; setTimeout(()=>err.style.display='none', 2000); return; }

            

            if(txt.startsWith('/') && isAdmin) {

                const p = txt.split(' ');

                txt = `CONSOLE: –í—ã–ø–æ–ª–Ω–µ–Ω–æ! [${p[1]}] –Ω–∞–∫–∞–∑–∞–Ω (${p[0].slice(1)}) –Ω–∞ ${p[2]||'1'} —á.`;

            }



            inp.value = "–û—Ç–ø—Ä–∞–≤–∫–∞...";

            await fetch(SS_URL, {method: 'POST', body: JSON.stringify({type: "send", user: currentUser, text: txt})});

            inp.value = ""; loadMessages();

        }



        async function loadMessages() {

            const res = await fetch(SS_URL);

            const data = await res.json();

            const box = document.getElementById('msgs');

            box.innerHTML = data.map((m, idx) => {

                if(m[1].includes(`@${currentUser}`)) {

                    if(!window.lM || window.lM !== m[2]) { notifSound.play(); window.lM = m[2]; }

                }

                const isC = m[1].startsWith('CONSOLE:');

                return `<div class="msg ${isC?'console-msg':''}" oncontextmenu="openCtxMenu(event, '${m[1]}', '${m[0]}', ${idx})">

                    <b>${m[0]}:</b> ${m[1]} <i style="font-size:9px; color:#444">${new Date(m[2]).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'})}</i>

                </div>`;

            }).join('');

        }



        function openCtxMenu(e, t, a, id) {

            e.preventDefault(); selText=t; selAuthor=a; selId=id;

            const menu = document.getElementById('context-menu');

            document.getElementById('admin-tools').style.display = (isAdmin || a === currentUser) ? 'block' : 'none';

            menu.style.display = 'block'; menu.style.left = e.pageX + 'px'; menu.style.top = e.pageY + 'px';

        }



        document.addEventListener('click', () => document.getElementById('context-menu').style.display = 'none');

        function copyMsg() { navigator.clipboard.writeText(selText); }

        function replyMsg() { document.getElementById('msg-text').value = `@${selAuthor}, `; document.getElementById('msg-text').focus(); }

        function pinMsg() { if(!isAdmin) return; document.getElementById('pin-panel').style.display = 'block'; document.getElementById('pin-content').innerText = `${selAuthor}: ${selText}`; }

        function unpinMsg() { if(isAdmin && confirm("–û—Ç–∫—Ä–µ–ø–∏—Ç—å?")) document.getElementById('pin-panel').style.display = 'none'; }

        async function deleteMsg() { if(confirm("–£–¥–∞–ª–∏—Ç—å?")) { await fetch(SS_URL, {method: 'POST', body: JSON.stringify({type: "delete", id: selId})}); loadMessages(); } }

    </script>

</body>

</html>
